@model manga_reader_web.Models.ChapterReadViewModel
@{
    ViewData["Title"] = $"{Model.MangaTitle} - Chapter {Model.ChapterNumber}";
    Layout = "_ChapterLayout";
}

<div class="container-fluid">
    @if (ViewBag.ErrorMessage != null)
    {
        <div class="alert alert-danger mb-4">@ViewBag.ErrorMessage</div>
    }
    
    <div class="reader-controls sticky-top bg-dark p-3 text-white">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <a asp-controller="Manga" asp-action="Details" asp-route-id="@Model.MangaId" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left"></i> Quay lại
                </a>
            </div>
            
            <div class="text-center">
                <h5 class="m-0">@Model.MangaTitle</h5>
                <div>@Model.ChapterTitle <span class="badge bg-info">@TranslateLanguage(Model.ChapterLanguage)</span></div>
            </div>
            
            <div class="d-flex gap-2">
                @if (!string.IsNullOrEmpty(Model.PrevChapterId))
                {
                    <a asp-action="Read" asp-route-id="@Model.PrevChapterId" asp-route-mangaId="@Model.MangaId" class="btn btn-outline-light">
                        <i class="bi bi-chevron-left"></i> Chương trước
                    </a>
                }
                
                @if (!string.IsNullOrEmpty(Model.NextChapterId))
                {
                    <a asp-action="Read" asp-route-id="@Model.NextChapterId" asp-route-mangaId="@Model.MangaId" class="btn btn-outline-light">
                        Chương sau <i class="bi bi-chevron-right"></i>
                    </a>
                }
            </div>
        </div>
    </div>
    
    <div class="d-flex flex-column align-items-center my-4">
        @if (Model.Pages != null && Model.Pages.Any())
        {
            @foreach (var imgPage in Model.Pages)
            {
                <div class="mb-2">
                    <img src="@imgPage" class="img-fluid manga-page" alt="Page" loading="lazy">
                </div>
            }
            
            <div class="my-4 d-flex gap-3 justify-content-center">
                @if (!string.IsNullOrEmpty(Model.PrevChapterId))
                {
                    <a asp-action="Read" asp-route-id="@Model.PrevChapterId" asp-route-mangaId="@Model.MangaId" class="btn btn-primary">
                        <i class="bi bi-chevron-left"></i> Chương trước
                    </a>
                }
                
                <a asp-controller="Manga" asp-action="Details" asp-route-id="@Model.MangaId" class="btn btn-secondary">
                    Danh sách chương
                </a>
                
                @if (!string.IsNullOrEmpty(Model.NextChapterId))
                {
                    <a asp-action="Read" asp-route-id="@Model.NextChapterId" asp-route-mangaId="@Model.MangaId" class="btn btn-primary">
                        Chương sau <i class="bi bi-chevron-right"></i>
                    </a>
                }
            </div>
        }
        else
        {
            <div class="text-center py-5">
                <h3>Không có dữ liệu trang cho chapter này</h3>
                <a asp-controller="Manga" asp-action="Details" asp-route-id="@Model.MangaId" class="btn btn-primary mt-3">
                    Quay lại trang chi tiết
                </a>
            </div>
        }
    </div>
</div>

@section Styles {
    <style>
        body {
            background-color: #222;
        }
        
        .manga-page {
            max-width: 100%;
            height: auto;
            display: block;
        }
        
        .reader-controls {
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
}

@section Scripts {
    <script>
        $(document).ready(function() {
            // Keyboard shortcuts
            $(document).keydown(function(e) {
                // Left arrow key
                if (e.keyCode == 37) {
                    var prevChapterLink = $('a:contains("Chương trước")').first();
                    if (prevChapterLink.length) {
                        window.location.href = prevChapterLink.attr('href');
                    }
                }
                
                // Right arrow key
                if (e.keyCode == 39) {
                    var nextChapterLink = $('a:contains("Chương sau")').first();
                    if (nextChapterLink.length) {
                        window.location.href = nextChapterLink.attr('href');
                    }
                }
            });
        });
    </script>
}

@functions {
    public string TranslateLanguage(string lang)
    {
        return lang switch
        {
            "vi" => "Tiếng Việt",
            "en" => "Tiếng Anh",
            _ => lang?.ToUpper() ?? "Không rõ"
        };
    }
} 